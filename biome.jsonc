{
  "$schema": "node_modules/@biomejs/biome/configuration_schema.json",
  "vcs": {
    "enabled": true,
    "clientKind": "git",
    "useIgnoreFile": true,
    "defaultBranch": "master"
  },
  "files": {
    "ignoreUnknown": false,
    "includes": ["**/*", "!pnpm-lock.yaml", "!CHANGELOG.md"]
  },
  "assist": {
    "enabled": true,
    "actions": {
      "source": {
        "organizeImports": {
          "level": "on",
          "options": {
            "identifierOrder": "lexicographic",
            "groups": [
              ":NODE:",
              ":PACKAGE:",
              ":BLANK_LINE:",
              ":ALIAS:",
              ":BLANK_LINE:",
              "../**/*",
              ":BLANK_LINE:",
              "./*"
            ]
          }
        }
      }
    }
  },
  "formatter": {
    "enabled": true,
    "formatWithErrors": false,
    "indentStyle": "space",
    "indentWidth": 2,
    "lineEnding": "lf",
    "lineWidth": 80,
    "attributePosition": "auto"
  },
  "linter": {
    "enabled": true,
    // enable "all" rules by default and override as needed in "overrides"
    "rules": {
      "a11y": "error",
      "complexity": "error",
      "correctness": "error",
      "performance": "error",
      "nursery": "error",
      "style": "error",
      "security": "error",
      "suspicious": "error"
    }
  },
  "javascript": {
    "formatter": {
      "enabled": true,
      "jsxQuoteStyle": "double",
      "quoteProperties": "asNeeded",
      "trailingCommas": "all",
      "semicolons": "asNeeded",
      "arrowParentheses": "always",
      "bracketSpacing": true,
      "bracketSameLine": false,
      "quoteStyle": "double",
      "lineWidth": 100
    },
    "assist": {
      "enabled": true
    },
    "linter": {
      "enabled": true
    }
  },
  "json": {
    "formatter": {
      "enabled": true,
      "lineWidth": 100,
      "trailingCommas": "none"
    },
    "assist": {
      "enabled": true
    },
    "parser": {
      "allowComments": true,
      "allowTrailingCommas": true
    },
    "linter": {
      "enabled": true
    }
  },
  "css": {
    "formatter": {
      "enabled": true,
      "quoteStyle": "double"
    },
    "assist": {
      "enabled": true
    },
    "linter": {
      "enabled": true
    },
    "parser": {
      "tailwindDirectives": true,
      "cssModules": false
    }
  },
  "html": {
    "formatter": {
      "enabled": true
    },
    "assist": {
      "enabled": true
    },
    "linter": {
      "enabled": true
    }
  },

  "overrides": [
    // override for "all" lint rules
    {
      "includes": ["**/*"],
      "linter": {
        "rules": {
          "complexity": {
            "noExcessiveLinesPerFunction": "info", // it should indicate potential for refactoring, but not too strict
            "noExcessiveCognitiveComplexity": "info", // it should indicate potential for refactoring, but not too strict
            "noVoid": "warn" // using void is sometimes useful, e.g. in void Promise
          },

          "a11y": {},

          "security": {},

          "style": {
            "noParameterProperties": "off", // parameter properties are encouraged in this codebase
            "noNestedTernary": "off", // sometimes nested ternary improves code conciseness and readability
            "noImplicitBoolean": "off", // implicit boolean is encouraged in this codebase
            "useDefaultSwitchClause": "off", // having default clause prevents TS exhaustiveness checks
            "useConsistentCurlyBraces": {
              "fix": "safe", // allow autofix
              "level": "warn"
            },
            "useTemplate": {
              "fix": "safe", // allow autofix
              "level": "warn"
            },
            "useExplicitLengthCheck": {
              "fix": "safe", // allow autofix
              "level": "warn"
            },
            "useNamingConvention": {
              "level": "warn",
              "fix": "unsafe",
              "options": {
                "strictCase": false // it complains about built in method name like "toJSON"
              }
            },
            "useConsistentArrayType": {
              // prefer Array<T> over T[]
              "level": "warn",
              "fix": "safe",
              "options": {
                "syntax": "generic"
              }
            },
            "useConsistentMemberAccessibility": {
              // enforce explicit accessibility modifiers for class members
              "level": "warn",
              "options": {
                "accessibility": "explicit"
              }
            },
            "useImportType": {
              "level": "warn",
              "options": {
                "style": "auto"
              }
            }
          },

          "correctness": {
            "useQwikClasslist": "off", // irrelevant
            "noSolidDestructuredProps": "off", // irrelevant

            "useImportExtensions": "off", // irrelevant,
            "noUndeclaredVariables": "off", // handled by TS
            "noUnusedImports": {
              // enable autofix
              "level": "warn",
              "fix": "safe"
            },
            "useUniqueElementIds": {
              "level": "warn",
              "options": {
                "excludedComponents": ["Profiler"]
              }
            },
            "useExhaustiveDependencies": {
              "level": "error",
              "options": {
                "reportUnnecessaryDependencies": true,
                "hooks": [
                  { "name": "useEffect", "closureIndex": 0, "dependenciesIndex": 1 },
                  { "name": "useLayoutEffect", "closureIndex": 0, "dependenciesIndex": 1 },
                  { "name": "useInsertionEffect", "closureIndex": 0, "dependenciesIndex": 1 },
                  { "name": "useCallback", "closureIndex": 0, "dependenciesIndex": 1 },
                  { "name": "useMemo", "closureIndex": 0, "dependenciesIndex": 1 },
                  { "name": "useComputed", "closureIndex": 0, "dependenciesIndex": 1 }
                ]
              }
            }
          },

          "performance": {
            "useSolidForComponent": "off", // irrelevant

            "noReExportAll": "off" // re-export all is used in this codebase
          },

          "suspicious": {
            "noReactSpecificProps": "off", // react is used in this codebase
            "noRedeclare": "off" // encouraged in this codebase (e.g. function overloads, type + fabric definitions)
          },

          "nursery": {
            "useQwikMethodUsage": "off", // irrelevant
            "useQwikValidLexicalScope": "off", // irrelevant
            "useVueMultiWordComponentNames": "off", // irrelevant
            "useVueDefineMacrosOrder": "off", // irrelevant
            "noEqualsToNull": "off", // == null is used to check for both null and undefined
            "noLeakedRender": "off", // many false-positives for boolean && JSX expressions
            "noVueReservedProps": "off", // irrelevant
            "noVueReservedKeys": "off", // irrelevant
            "noVueDuplicateKeys": "off", // irrelevant
            "noVueDataObjectDeclaration": "off", // irrelevant
            "noTernary": "off", // ternary is useful in many cases

            "noUnresolvedImports": "off", // handled by TS
            "noUselessUndefined": "off", // it is better to be explicit about undefined values
            "useExplicitType": "off", // it is too much noise to enforce explicit types everywhere, even none module-public exports
            "useMaxParams": "off", // common...
            "useAwaitThenable": "off", // false-positives
            "noJsxPropsBind": "off", // it is madness to follow this rule

            "useDestructuring": "info",
            "noExcessiveLinesPerFile": "info",
            "noMultiAssign": "info"
          }
        }
      }
    },

    // source code setup
    {
      "includes": ["**/src/**/*", "!**/__tests__/**/*", "!**/tools/src/testing/**/*"],
      "linter": {
        "rules": {
          "style": {
            "noRestrictedGlobals": {
              "level": "error",
              "options": {
                "deniedGlobals": {
                  "vi": "Use vitest only in test files"
                }
              }
            }
          }
        }
      }
    },

    // packages entrypoints
    {
      "includes": ["packages/*/src/index.ts"],
      "linter": {
        "rules": {
          "style": {
            "noRestrictedImports": {
              "level": "error",
              "options": {
                "patterns": [
                  {
                    "group": ["**/_internal/**/*"],
                    "message": "Importing from _internal is not allowed in package entrypoints."
                  }
                ]
              }
            }
          },
          "performance": {
            "noBarrelFile": "off" // allow re-exporting from barrel files in package entrypoints
          }
        }
      }
    },

    // dev env setup
    {
      "includes": ["./*.{mjs,ts}", "./packages/*/*.{js,ts}"],
      "linter": {
        "rules": {
          "style": {
            "useNamingConvention": "off", // devtools might use different naming conventions
            "noDefaultExport": "off" // devtools might use default exports
          },
          "suspicious": {
            "noConsole": "off" // devtools often use console
          }
        }
      }
    },

    // docs env setup
    {
      "includes": ["./docs/**/*.{ts,tsx,m?js,jsx}"],
      "linter": {
        "rules": {
          "style": {
            "noDefaultExport": "off" // docs use default exports
          }
        }
      }
    },

    // d.ts files
    {
      "includes": ["**/*.d.ts"],
      "linter": {
        "rules": {
          "style": {
            "useExportsLast": "off" // declaration files often have exports throughout the file
          },
          "correctness": {
            "noUnusedImports": "off" // declaration files often have unused imports
          },
          "nursery": {
            "noShadow": "off" // shadowing is common in declaration files
          }
        }
      }
    },

    // test env setup
    {
      "includes": ["**/tests/**/*.{ts,tsx}", "./packages/*/setup-tests.{ts,tsx}"],
      "linter": {
        "rules": {
          "style": {
            "noMagicNumbers": "off", // magic numbers are fine in tests
            "noNonNullAssertion": "off",
            "noDoneCallback": "off", // false-positive for context in hooks like "beforeAll(context => { context.thing = 42 })"
            "useComponentExportOnlyModules": "off" // tests might export non-component modules
          },
          "complexity": {
            "noExcessiveLinesPerFunction": "off" // test `describe/it` blocks can be long
          },
          "suspicious": {
            "noArrayIndexKey": "off", // array index keys are fine in tests
            "noConfusingVoidType": "off", // void is often used to follow source signatures
            "noMisplacedAssertion": "off" // false-positives when abstracting expect assertions in helper functions
          },
          "security": {
            "noSecrets": "off" // too much false-positives in tests
          },
          "nursery": {
            "noJsxLiterals": "off", // jsx literals are fine in tests
            "noShadow": "off", // shadowing is fine in tests
            "noIncrementDecrement": "off", // increment/decrement is fine in tests
            "noExcessiveLinesPerFile": "off", // tests files can be long
            "noExcessiveClassesPerFile": "off" // test files can have many test classes
          }
        }
      }
    },

    // public packages test env setup
    {
      "includes": ["packages/signal*/tests/**/*.{ts,tsx}"],
      "linter": {
        "rules": {
          "style": {
            "noRestrictedImports": {
              "level": "error",
              "options": {
                "patterns": [
                  {
                    "group": ["**/src/*"],
                    "message": "Import only ../src for tests to ensure production-like imports."
                  }
                ]
              }
            }
          }
        }
      }
    }
  ]
}
